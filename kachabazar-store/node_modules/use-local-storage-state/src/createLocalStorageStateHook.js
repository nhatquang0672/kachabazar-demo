"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const react_dom_1 = require("react-dom");
const react_1 = require("react");
const useLocalStorageStateBase_1 = require("./useLocalStorageStateBase");
function createLocalStorageStateHook(key, defaultValue) {
    const setValueFunctions = [];
    const removeItemFunctions = [];
    return function useLocalStorageStateHook() {
        const [value, setValue, { isPersistent, removeItem }] = (0, useLocalStorageStateBase_1.default)(key, defaultValue);
        const setValueAll = (0, react_1.useCallback)((newValue) => {
            (0, react_dom_1.unstable_batchedUpdates)(() => {
                for (const setValueFunction of setValueFunctions) {
                    setValueFunction(newValue);
                }
            });
        }, []);
        (0, react_1.useEffect)(() => {
            setValueFunctions.push(setValue);
            removeItemFunctions.push(removeItem);
            return () => {
                setValueFunctions.splice(setValueFunctions.indexOf(setValue), 1);
                removeItemFunctions.splice(removeItemFunctions.indexOf(removeItem), 1);
            };
        }, [setValue, removeItem]);
        return (0, react_1.useMemo)(() => [
            value,
            setValueAll,
            {
                isPersistent,
                removeItem() {
                    for (const removeItemFunction of removeItemFunctions) {
                        removeItemFunction();
                    }
                },
            },
        ], [value, setValueAll, isPersistent]);
    };
}
exports.default = createLocalStorageStateHook;
